<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Kilotest">
    <meta name="creator" content="Kilotest">
    <meta name="publisher" name="Kilotest">
    <meta name="description" content="report of accessibility testing of a web page">
    <meta name="keywords" content="accessibility a11y web testing">
    <title>__pageName__ | Kilotest results</title>
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="kilotest/style.css">
  </head>
  <body>
    <main>
      <header>
        <h1>Kilotest results: __pageName__</h1>
      </header>
      <h2>Basics</h2>
      <ul>
        <li>Test date: __testDate__</li>
        <li>Page: __pageID__</li>
        <li>Page URL: __pageURL__</li>
      </ul>
      <h2>Details</h2>
      <div id="progress"></div>
      <div id="results"></div>
      <script>
        const progressDiv = document.getElementById('progress');
        // Start listening for progress messages.
        const eventSource = new EventSource('/kilotest/events/__jobID__');
        // When a progress message arrives:
        eventSource.onmessage = event => {

          const msg = JSON.parse(event.data);
          // If it identifies a tool being started:
          if (msg.type === 'tool') {
            // Display a paragraph reporting this.
            const eventPar = document.createElement('p');
            eventPar.textContent = 'Starting tests of ' + msg.toolName;
            progressDiv.appendChild(eventPar);
          }
          // Otherwise, if it is a final report:
          else if (msg.type === 'report') {
            // Display results based on it.
            const resultsDiv = document.getElementById('results');
            const results = JSON.stringify(msg.report).length;
            const resultsPar = document.createElement('p');
            resultsPar.textContent = `Report length is ${results} characters`;
            resultsDiv.appendChild(resultsPar);
            // Stop listening for progress messages.
            eventSource.close();
          }
        };
      </script>
    </main>
  </body>
</html>
